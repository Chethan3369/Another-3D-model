import React, { useRef, useEffect } from "react";
import { useGLTF } from "@react-three/drei";
import { gsap } from "gsap";

export default function WashingMachine(props) {
  const group = useRef();
  const drumRef = useRef();
  const doorRef = useRef();

  const { scene } = useGLTF("/models/washing_machine.gltf");

  // Find parts inside GLTF (safe even if simple model)
  useEffect(() => {
    scene.traverse((child) => {
      if (child.name.toLowerCase().includes("drum")) drumRef.current = child;
      if (child.name.toLowerCase().includes("door")) doorRef.current = child;
    });
  }, [scene]);

  // Spin drum continuously
  useEffect(() => {
    if (!drumRef.current) return;

    gsap.to(drumRef.current.rotation, {
      z: Math.PI * 2,
      duration: 2,
      repeat: -1,
      ease: "linear",
    });
  }, []);

  // Door open on click
  const handleClick = () => {
    if (!doorRef.current) return;

    gsap.to(doorRef.current.rotation, {
      y: doorRef.current.rotation.y === 0 ? -Math.PI / 1.8 : 0,
      duration: 0.8,
      ease: "power2.out",
    });
  };

  return (
    <group ref={group} onClick={handleClick} {...props}>
      <primitive object={scene} />
    </group>
  );
}

useGLTF.preload("/models/washing_machine.gltf");
